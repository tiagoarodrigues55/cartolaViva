<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>propaganda</title>
</head>
<link rel="stylesheet" href="cartola.css">
<body>
    <section id="prop" style="width: 1000px; height: 600px;">
        <h1>O que vocÃª prefere? Clique na imagem</h1>
        <div id="prop1" style="display: inline-block;"></div>
        <div id="prop2" style="display: inline-block;"></div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>

    <script>
var div = document.querySelector('#prop1')
var div2 = document.querySelector('#prop2')

function gerarPropaganda(nome, src, src2, width1, height1, width2, height2, txt, txt2){
var link1 = document.createElement('a');

link1.setAttribute('onclick', `contabilizar(${nome}, 0)`);
var link2 = document.createElement('a');
link2.setAttribute('onclick', `contabilizar(${nome}, 1)`);
var nome0 = document.createElement('p');
var textnome0 = document.createTextNode(txt);
nome0.appendChild(textnome0);
div.appendChild(nome0);
var img0 = document.createElement('img');
img0.src = src;
img0.width = width1;
img0.height = height1;
link1.appendChild(img0);
div.appendChild(link1);

var nome1 = document.createElement('p');
var textnome1 = document.createTextNode(txt2);
nome1.appendChild(textnome1);
div2.appendChild(nome1);

var img1 = document.createElement('img');
img1.src = src2;
img1.width = width2;
img1.height = height2;
link2.appendChild(img1);
div2.appendChild(link2);
};
var propagandas
var Bl31 = []
axios.get('http://localhost:3000/propagandas').then(async response => {
    propagandas = await response.data
    espera()
})
axios.get('http://localhost:3000/propagandas/5/porcentagem').then(response => {
    for(i of response.data){
        Bl31.push(i.dados)
    }
})
var r = 0
function espera(){

var nomes = propagandas[r].nome
var fotos1 = propagandas[r].foto1
var fotos2 = propagandas[r].foto2
var width1 = propagandas[r].width1
var height1 = propagandas[r].height1
var width2 = propagandas[r].width2
var height2 = propagandas[r].height2
var txt1 = propagandas[r].txt1
var txt2 = propagandas[r].txt2

gerarPropaganda(nomes, fotos1, fotos2, width1, height1, width2, height2, txt1, txt2);
}
function contabilizar(p, n){
    p.push(n)
    var p0 = 0
    for(var i of p){
        if (i === 0){
            p0 += 1
        }
    }
    var porP = p0/p.length*100
    
    axios.put(`http://localhost:3000/propagandas/${r+5}`, {porcentagem: porP})
    axios.post(`http://localhost:3000/propagandas/${r+5}/porcentagem`, {dados: n})
    
    saveToStorage()
    window.location.href = 'cartola.html'
}

function saveToStorage() {
    localStorage.setItem('propaganda_Bl31', JSON.stringify(Bl31))
    localStorage.setItem('list_propagandas', JSON.stringify(propagandas))
    
}

    </script>
</body>
</html>